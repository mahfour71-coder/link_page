<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸ“Š Ù‚Ø±Ø§Ø¡Ø© Excel + Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù†ØµÙˆØµ Ù…Ù† Ø§Ù„ØµÙˆØ±</title>

  <!-- Ù…ÙƒØªØ¨Ø© Ù‚Ø±Ø§Ø¡Ø© Excel -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <!-- Ù…ÙƒØªØ¨Ø© Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù†ØµÙˆØµ Ù…Ù† Ø§Ù„ØµÙˆØ± (OCR) -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5.0.2/dist/tesseract.min.js"></script>

  <style>
    body {
      font-family: "Segoe UI", Tahoma, sans-serif;
      background-color: #f4f6f8;
      padding: 30px;
      text-align: center;
      direction: rtl;
    }
    h1 {
      color: #0078d7;
    }
    .box {
      background: white;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      padding: 20px;
      margin: 20px auto;
      width: 90%;
      max-width: 750px;
    }
    input[type="file"] {
      margin: 10px 0;
    }
    table {
      border-collapse: collapse;
      margin: 20px auto;
      width: 100%;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
    }
    th {
      background-color: #0078d7;
      color: white;
    }
    .preview {
      margin-top: 20px;
      border: 1px dashed #ccc;
      padding: 10px;
      border-radius: 10px;
      background-color: #fafafa;
    }
    img {
      max-width: 100%;
      border-radius: 10px;
    }
    .loading {
      color: #0078d7;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>ğŸ“Š Ù‚Ø±Ø§Ø¡Ø© Excel + Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„ØµÙˆØ± ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§</h1>

  <div class="box">
    <h3>ğŸ“ Ø§Ø±ÙØ¹ Ù…Ù„Ù Excel</h3>
    <input type="file" id="excelInput" accept=".xlsx,.xls" />
    <p id="excelStatus">Ù„Ù… ÙŠØªÙ… Ø±ÙØ¹ Ù…Ù„Ù Ø¨Ø¹Ø¯</p>
    <table id="excelTable"></table>

    <hr />

    <h3>ğŸ–¼ï¸ Ø§Ø±ÙØ¹ ØµÙˆØ±Ø©</h3>
    <input type="file" id="imageInput" accept="image/*" />
    <div class="preview" id="imagePreview">Ù„Ù… ÙŠØªÙ… Ø±ÙØ¹ ØµÙˆØ±Ø© Ø¨Ø¹Ø¯</div>
    <p id="ocrStatus"></p>
  </div>

  <script>
    // Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù Excel
    const excelInput = document.getElementById("excelInput");
    const excelTable = document.getElementById("excelTable");
    const excelStatus = document.getElementById("excelStatus");
    let excelData = []; // Ù„Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¤Ù‚ØªÙ‹Ø§

    excelInput.addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(event) {
        const data = new Uint8Array(event.target.result);
        const workbook = XLSX.read(data, { type: "array" });
        const sheetName = workbook.SheetNames[0];
        const worksheet = workbook.Sheets[sheetName];
        excelData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
        excelStatus.textContent = "âœ… ØªÙ… Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù Excel Ø¨Ù†Ø¬Ø§Ø­";
        displayTable(excelData);
      };
      reader.readAsArrayBuffer(file);
    });

    function displayTable(data) {
      excelTable.innerHTML = "";
      data.forEach((row, i) => {
        const tr = document.createElement("tr");
        row.forEach((cell) => {
          const el = document.createElement(i === 0 ? "th" : "td");
          el.textContent = cell;
          tr.appendChild(el);
        });
        excelTable.appendChild(tr);
      });
    }

    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ Ù…Ù† Ø§Ù„ØµÙˆØ±Ø©
    const imageInput = document.getElementById("imageInput");
    const imagePreview = document.getElementById("imagePreview");
    const ocrStatus = document.getElementById("ocrStatus");

    imageInput.addEventListener("change", () => {
      if (imageInput.files.length > 0) {
        const file = imageInput.files[0];
        const reader = new FileReader();
        reader.onload = function(e) {
          imagePreview.innerHTML = `<img src="${e.target.result}" alt="Uploaded image" />`;
          extractText(e.target.result);
        };
        reader.readAsDataURL(file);
      }
    });

    // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù†Øµ Ù…Ù† Ø§Ù„ØµÙˆØ±Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… tesseract.js
    function extractText(imageData) {
      ocrStatus.innerHTML = "ğŸ”„ Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©...";
      Tesseract.recognize(imageData, 'ara', {
        logger: (m) => console.log(m)
      }).then(({ data: { text } }) => {
        ocrStatus.innerHTML = "âœ… ØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ:";
        const p = document.createElement("p");
        p.textContent = text.trim();
        imagePreview.appendChild(p);

        // Ù†Ø¶ÙŠÙ Ø§Ù„Ù†Øµ Ø¯Ù‡ ÙƒØµÙ Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
        if (excelData.length > 0) {
          excelData.push([text]);
          displayTable(excelData);
        } else {
          excelData = [["Ù†Øµ Ù…Ø³ØªØ®Ø±Ø¬"], [text]];
          displayTable(excelData);
        }
      }).catch(err => {
        ocrStatus.innerHTML = "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©";
        console.error(err);
      });
    }
  </script>
</body>
</html>
